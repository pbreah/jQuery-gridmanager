/*! gridmanager - v0.2.0 - 2014-05-21
* http://neokoenig.github.io/jQuery-gridmanager/
* Copyright (c) 2014 Tom King; Licensed MIT */
!function(a){a.gridmanager=function(b,c){var d=this;d.$el=a(b),d.el=b,d.$el.data("gridmanager",d),d.init=function(){d.options=a.extend({},a.gridmanager.defaultOptions,c),d.log("INIT"),d.rteControl("init"),d.createCanvas(),d.createControls(),d.initControls(),d.initCanvas()},d.reset=function(){d.deinitCanvas(),d.initCanvas()},d.createCanvas=function(){d.log("-Create Canvas");var a=d.$el.html();d.$el.html("");var b="<div id="+d.options.canvas.id+">"+a+"</div>";d.$el.append(b)},d.createControls=function(){d.log("-Create Controls");var b="<div id="+d.options.controls.id+">"+d.options.controls.prepend,c="";a.each(d.options.buttons,function(a,e){c=d.generateButtonClass(e),b=b+"<a title='Add Row "+c+"' class='btn  btn-xs  btn-info add"+c+"'><span class='glyphicon glyphicon-plus-sign'></span> "+c+"</a>"}),b+=d.options.controls.append,d.$el.prepend(b)},d.initControls=function(){d.log("---InitControls Running"),a.each(d.options.buttons,function(a,b){d.generateClickHandler(b)}),d.$el.on("click","button.gm-switch",function(){d.status?(d.deinitCanvas(),a(this).text("Editor ON")):(d.initCanvas(),a(this).text("Editor OFF"))}),d.$el.on("click","a.gm-save",function(){d.deinitCanvas(),d.saveremote()}),d.$el.on("click","a.gm-viewsource",function(){var a="#"+d.options.canvas.id;d.deinitCanvas(),window.alert(d.$el.find(a).html())}),d.$el.on("click","a.gm-resetgrid",function(){var a="#"+d.options.canvas.id;d.$el.find(a).html("")}),d.$el.on("click","a.gm-remove",function(){a(this).closest("div.gm-editing").remove()}),d.$el.on("click","a.gm-remove, a.gm-save, button.gm-switch, a.gm-viewsource",function(a){a.preventDefault()})},d.initCanvas=function(){var a=d.$el.find("#"+d.options.canvas.id),b=a.find(d.options.col.selector),c=a.find(d.options.row.selector);d.log("---InitCanvas Running"),d.activateRows(c),d.activateCols(b),a.sortable({items:d.options.row.selector+".gm-editing",axis:"y",placeholder:"bg-warning",handle:".handle-row",forcePlaceholderSize:!0,opacity:.7,revert:!0}),c.sortable({items:d.options.col.selector,axis:"x",handle:".handle-col",forcePlaceholderSize:!0,opacity:.7,revert:!0}),d.rteControl("start"),d.status=!0},d.deinitCanvas=function(){var a=d.$el.find("#"+d.options.canvas.id),b=a.find(d.options.col.selector),c=a.find(d.options.row.selector);d.log("---deInitCanvas Running"),d.deactivateRows(c),d.deactivateCols(b),d.cleanup(),d.rteControl("stop"),d.status=!1},d.activateRows=function(b){b.addClass("gm-editing"),a.each(b,function(b,c){a(c).prepend(d.options.row.tools)}),d.log("Activate Rows Ran")},d.deactivateRows=function(a){a.removeClass("gm-editing").removeClass("ui-sortable").removeAttr("style"),d.log("DeActivate Rows Ran")},d.activateCols=function(b){b.addClass("gm-editing"),a.each(b,function(b,c){var e=a(c).html();a(c).html(d.options.col.tools+"<div class='gm-editholder' contenteditable=true>"+e+"</div>")}),d.log("Activate Cols Ran")},d.deactivateCols=function(b){b.removeClass("gm-editing"),a.each(b,function(b,c){var d=a(c).find(".gm-editholder").html();a(c).html(d)}),d.log("deActivate Cols Ran")},d.generateClickHandler=function(b){var c="a.add"+d.generateButtonClass(b),e=d.$el.find("#"+d.options.canvas.id),f=d.options.row.prepend+d.options.row.tools;a.each(b,function(a,b){f+=d.generateColumn(b)}),d.$el.on("click",c,function(a){d.log("Clicked "+c),e.append(f),d.reset(),a.preventDefault()})},d.generateButtonClass=function(b){var c="";return a.each(b,function(a,b){c=c+"-"+b}),c},d.generateColumn=function(a){return"<div class='col-md-"+a+" gm-editing'>"+d.options.col.tools+"<div class='gm-editholder' contenteditable=true> Content here </div></div>"},d.cleanup=function(){var a=d.$el.find("#"+d.options.canvas.id);a.find(d.options.col.selector).removeAttr("style").removeAttr("spellcheck").removeAttr("id").removeClass("mce-content-body").end().find("img").removeAttr("style").addClass("img-responsive").removeAttr("data-cke-saved-src").removeAttr("data-mce-src").end().find("div.gm-tools").remove()},d.rteControl=function(b){switch(d.log("-- RTE ---"+d.options.rte+" "+b),b){case"init":"undefined"!=typeof window.CKEDITOR&&(d.options.rte="ckeditor",d.log("CKEDITOR Found"),window.CKEDITOR.disableAutoInline=!0),"undefined"!=typeof window.tinymce&&(d.options.rte="tinymce",d.log("TINYMCE Found"));break;case"start":switch(d.options.rte){case"tinymce":window.tinymce.init(d.options.tinymce.config);break;case"ckeditor":a("div.gm-editholder").ckeditor(d.options.ckeditor),d.log(d.options.ckeditor);break;default:d.log("No RTE specified for start")}break;case"stop":switch(d.options.rte){case"tinymce":window.tinymce.remove();break;case"ckeditor":for(var c in window.CKEDITOR.instances)window.CKEDITOR.instances[c].destroy();break;default:d.log("No RTE specified for stop")}break;default:d.log("No RTE Action specified")}},d.saveremote=function(){var b="#"+d.options.canvas.id,c=d.log(d.$el.find(b).html());a.ajax({type:"POST",url:d.options.remoteURL,data:c}),d.log("Save Function Called")},d.log=function(a){d.options.debug&&void 0!==window.console&&window.console.log(a)},d.init()},a.gridmanager.defaultOptions={debug:0,remoteURL:"/replace-with-your-url",canvas:{id:"gm-canvas"},buttons:[[12],[6,6],[4,4,4],[3,3,3,3],[2,2,2,2,2,2],[2,8,2],[4,8],[8,4]],controls:{id:"gm-controls",prepend:"<div class='row'><div class='col-md-12'><div id='gridmanager-addnew' class='btn-group'>",append:"</div><div class='btn-group pull-right'><button type='button' class='btn btn-xs btn-primary gm-switch'>Editor</button><button type='button' class='btn  btn-xs  btn-primary dropdown-toggle' data-toggle='dropdown'><span class='caret'></span><span class='sr-only'>Toggle Dropdown</span></button><ul class='dropdown-menu' role='menu'><li><a title='Save'  href='#' class='gm-save'><span class='glyphicon glyphicon-ok'></span> Save</a></li><li><a title='View Source' href='#' class='gm-viewsource'><span class='glyphicon glyphicon-zoom-in'></span> View Source</a></li><li><a title='Reset Grid' href='#' class='gm-resetgrid'><span class='glyphicon glyphicon-trash'></span> Reset</a></li></ul></div>"},row:{selector:"div.row",prepend:"<div class='row gm-editing'>",append:"</div>",tools:"<div class='gm-tools clearfix'><a title='Move' class='handle-row pull-left btn btn-info btn-xs'><span class='glyphicon glyphicon-resize-vertical'></span></a><a title='Remove row'  class=' pull-right gm-remove btn btn-danger btn-xs'><span class='glyphicon glyphicon-trash'></span></a></div>"},col:{selector:"div[class*=col-]",tools:"<div class='gm-tools clearfix'><a title='Move' class='handle-col pull-left btn btn-info btn-xs'><span class='glyphicon glyphicon-resize-horizontal'></span></a><a title='Remove column'  class=' pull-right gm-remove btn btn-danger btn-xs'><span class='glyphicon glyphicon-trash'></span></a></div>"},tinymce:{config:{selector:"[contenteditable='true']",inline:!0,plugins:["advlist autolink lists link image charmap print preview anchor","searchreplace visualblocks code fullscreen","insertdatetime media table contextmenu paste"],toolbar:"insertfile undo redo | styleselect | bold italic | alignleft aligncenter alignright alignjustify | bullist numlist outdent indent | link image"}},ckeditor:{customConfig:""}},a.fn.gridmanager=function(b){return this.each(function(){new a.gridmanager(this,b)})}}(jQuery);