/*! gridmanager - v0.1.1 - 2014-05-19
* http://neokoenig.github.io/jQuery-gridmanager/
* Copyright (c) 2014 Tom King; Licensed MIT */
!function(a){a.gridmanager=function(b,c){var d=this;d.$el=a(b),d.el=b,d.$el.data("gridmanager",d),d.init=function(){d.options=a.extend({},a.gridmanager.defaultOptions,c),d.createCanvas(),d.createControls(),d.initControls(),d.initCanvas()},d.createCanvas=function(){var a=d.$el.html();d.$el.html("");var b="<div id="+d.options.canvas.id+">"+a+"</div>";d.$el.append(b)},d.createControls=function(){var b="<div id="+d.options.controls.id+">"+d.options.controls.prepend,c="";a.each(d.options.buttons,function(a,e){c=d.generateButtonClass(e),b=b+"<a title='Add Row "+c+"' class='btn btn-default add"+c+"'><span class='glyphicon glyphicon-plus-sign'></span> "+c+"</a>"}),b+=d.options.controls.append,d.log("Control Buttons created"),d.$el.prepend(b)},d.initControls=function(){a.each(d.options.buttons,function(a,b){d.generateClickHandler(b)}),d.$el.on("click","a.preview-all",function(a){d.cleanup(),a.preventDefault()}),d.$el.on("click","a.save-all",function(a){d.cleanup(),d.saveremote(),a.preventDefault()}),d.$el.on("click","a.remove-row",function(){a(this).parent().parent().remove()}),d.$el.on("click","a.remove-row, a.edit-all",function(a){d.initCanvas(),a.preventDefault()})},d.initCanvas=function(){var a="#"+d.options.canvas.id;d.$el.find(a+" [class*=col-]").attr("contenteditable",!0).end().find(a+" div.tools").remove().end().find(a+" [class*=col-] img").addClass("img-responsive").end().find(a+" div.row").addClass("editing").prepend(d.options.row.tools).end().find(a).sortable({axis:"y",cursor:"move",handle:".handle-row",forcePlaceholderSize:!0,opacity:.7,revert:!0,placeholder:"bg-warning"}),d.tinymceStart(),d.log("InitCanvas Ran")},d.generateClickHandler=function(b){var c="a.add"+d.generateButtonClass(b),e="#"+d.options.canvas.id,f=d.options.row.prepend;a.each(b,function(a,b){f+=d.colmd(b)}),d.$el.on("click",c,function(a){d.log("Clicked "+c),d.$el.find(e).append(f),d.initCanvas(),a.preventDefault()})},d.generateButtonClass=function(b){var c="";return a.each(b,function(a,b){c=c+"-"+b}),c},d.colmd=function(a){return"<div class='col-md-"+a+"'></div>"},d.cleanup=function(){var a="#"+d.options.canvas.id;d.$el.find(a+" div.tools").remove().end().find(a+" div.row").removeAttr("style").removeClass("editing").end().find(a+" [class*=col-]").removeAttr("spellcheck").removeAttr("id").removeClass("mce-content-body").end().find(a+" img").removeAttr("style").removeAttr("data-mce-src").addClass("img-responsive").end().find(a+" div").removeAttr("contenteditable"),d.tinymceStop(),d.log("Cleanup Ran")},d.tinymceStart=function(){window.tinymce.init(d.options.tinyMCE),d.log("TinyMCE Started")},d.tinymceStop=function(){window.tinymce.remove(),d.log("TinyMCE Removed")},d.saveremote=function(){var b="#"+d.options.canvas.id,c=d.log(d.$el.find(b).html());a.ajax({type:"POST",url:d.options.remoteURL,data:c}),d.log("Save Function Called")},d.log=function(a){d.options.debug&&void 0!==window.console&&window.console.log(a)},d.init()},a.gridmanager.defaultOptions={debug:0,remoteURL:"/replace-with-your-url",canvas:{id:"gridmanager-canvas"},buttons:[[12],[6,6],[4,4,4],[3,3,3,3],[2,2,2,2,2,2],[2,8,2],[4,8],[8,4]],controls:{id:"gridmanager-controls",prepend:"<div class='row'><div class='col-md-12'><div id='gridmanager-addnew' class='btn-group'>",append:"</div><div id='gridmanager-util' class='btn-group pull-right'><a title='Turn on editing'  class='btn btn-info edit-all '><span class='glyphicon glyphicon-edit'></span></a><a title='Preview' class='btn btn-success preview-all '><span class='glyphicon glyphicon-eye-open'></span></a><a title='Save' class='btn btn-primary save-all '><span class='glyphicon glyphicon-floppy-disk'><span></a></div></div></div>"},row:{prepend:"<div class='row'>",append:"</div>",tools:"<div class='tools clearfix'><a title='Move row' class='handle-row pull-left btn btn-info btn-xs'><span class='glyphicon glyphicon-move'></span> Move</a><a title='Remove row'  class=' pull-right remove-row btn btn-danger btn-xs'><span class='glyphicon glyphicon-trash'></span> Remove</a></div>"},tinyMCE:{selector:"[contenteditable='true']",inline:!0,plugins:["advlist autolink lists link image charmap print preview anchor","searchreplace visualblocks code fullscreen","insertdatetime media table contextmenu paste"],toolbar:"insertfile undo redo | styleselect | bold italic | alignleft aligncenter alignright alignjustify | bullist numlist outdent indent | link image"}},a.fn.gridmanager=function(b){return this.each(function(){new a.gridmanager(this,b)})}}(jQuery);